<div class="comments-section">
  <!-- Comments List Section -->
  <div class="comments-list-section">
    <h4 class="section-title">
      {{ "our_story.comments.title" | translate }} ({{ comments.length }})
    </h4>

    <div class="comments-list" *ngIf="comments.length > 0">
      <div
        class="comment-item"
        *ngFor="let comment of comments; trackBy: trackByCommentId"
      >
        <div class="comment-header">
          <span class="comment-author">{{ comment.authorName }}</span>
          <span class="comment-date">{{ formatDate(comment.createdAt) }}</span>
        </div>

        <!-- Render HTML content safely -->
        <div
          class="comment-content"
          [innerHTML]="comment.content | safeHtml"
        ></div>
      </div>
    </div>

    <div class="no-comments" *ngIf="comments.length === 0">
      <p>{{ "our_story.comments.no_comment" | translate }}</p>
    </div>
  </div>

  <!-- Comment Form Section -->
  <div class="comment-form-section">
    <h4 class="section-title">
      {{ "our_story.comments.leave_comment_message" | translate }}
    </h4>

    <form
      [formGroup]="commentForm"
      (ngSubmit)="onSubmit()"
      class="comment-form"
    >
      <div class="form-group">
        <label for="authorName" class="form-label">Nickname *</label>
        <input
          type="text"
          id="authorName"
          formControlName="authorName"
          class="form-input"
          [placeholder]="'our_story.comments.nickname_placeholder' | translate"
          [class.error]="
            commentForm.get('authorName')?.invalid &&
            commentForm.get('authorName')?.touched
          "
        />
        <div
          class="error-message"
          *ngIf="
            commentForm.get('authorName')?.invalid &&
            commentForm.get('authorName')?.touched
          "
        >
          {{ getErrorMessage("authorName") }}
        </div>
      </div>

      <div class="form-group">
        <label for="messageHtml" class="form-label">
          {{ "our_story.comments.comment" | translate }} *
        </label>

        <app-rich-text-editor
          id="messageHtml"
          formControlName="messageHtml"
          [placeholder]="'our_story.comments.write_comment' | translate"
          [emojiEnabled]="true"
          (lengthChange)="currentLen = $event"
        ></app-rich-text-editor>

        <!-- Counter lives in parent -->
        <div class="char-count">
          {{ currentLen || 0 }}/{{ maxMessageLength }}
        </div>

        <!-- Validation errors (parent-driven) -->
        <div
          class="error-message"
          *ngIf="
            commentForm.get('messageHtml')?.invalid &&
            commentForm.get('messageHtml')?.touched
          "
        >
          {{ getErrorMessage("messageHtml") }}
        </div>
      </div>

      <button
        type="submit"
        class="submit-btn"
        [disabled]="commentForm.invalid || isSubmitting"
      >
        <span *ngIf="!isSubmitting">{{
          "our_story.comments.submit" | translate
        }}</span>
        <span *ngIf="isSubmitting">{{
          "our_story.comments.submitting" | translate
        }}</span>
      </button>
    </form>
  </div>
</div>
