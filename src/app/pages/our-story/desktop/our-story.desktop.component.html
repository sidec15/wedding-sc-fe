<!-- Only show controls if we have cards -->
@if (cards.length > 0) {
<ng-container *ngTemplateOutlet="navigationControls"></ng-container>
}

<div
  class="card-wrapper"
  [ngClass]="{
    'intro-card': activeCard.type === 'intro',
    'outro-card': activeCard.type === 'outro',
    transitioning: isTransitioning
  }"
>
  <ng-container
    *ngTemplateOutlet="
      activeCard.type === 'card' ? cardTemplate : textOnlyTemplate;
      context: {
        $implicit: activeCard,
        isNext: isTransitioning && activeCard === cards[nextIndex]
      }
    "
  ></ng-container>
</div>

<!-- Intro/Outro full-screen text -->
<ng-template #textOnlyTemplate let-card>
  @if (card.type === 'intro' || card.type === 'outro') {
  <div class="text-only-card">
    <div
      class="text-content"
      [ngClass]="{
        visible: card.status === 'visible',
        hidden: card.status === 'hidden',
        'transitioning-in': card.status === 'transitioning-in',
        'transitioning-out': card.status === 'transitioning-out'
      }"
    >
      <h2>{{ card.title | translate }}</h2>
      <p>{{ card.description | translate }}</p>
    </div>
  </div>
  }
</ng-template>

<!-- Regular three-column card -->
<ng-template #cardTemplate let-card let-isNext="isNext">
  @if (card.type === 'card') {
  <div
    class="three-column-layout"
    [ngClass]="{
      'next-card': isNext,
      hidden: card.status === 'hidden',
      visible: card.status === 'visible',
      current: card.position === 'current',
      before: card.position === 'before',
      after: card.position === 'after'
    }"
  >
    <!-- Left: Text -->
    <div class="text-column">
      <div
        class="text-content"
        [ngClass]="{ visible: card.status === 'visible' }"
      >
        <h2>{{ card.title | translate }}</h2>
        <p class="description">{{ card.description | translate }}</p>
      </div>
    </div>

    <!-- Center: Image -->
    @if (card.image) {
    <div class="image-column">
      <div
        class="image-container"
        [ngClass]="{
          visible: card.status === 'visible',
          before: card.position === 'before',
          after: card.position === 'after',
          'slide-in-from-left': card.position === 'slide-in-from-left',
          'slide-in-from-right': card.position === 'slide-in-from-right'
        }"
      >
        <img [src]="card.image" [alt]="card.title" />
      </div>
    </div>
    }

    <!-- Right: Comics -->
    @if (card.comics && card.comics.length > 0) {
    <div class="comic-column">
      <div
        class="comic-container"
        [ngClass]="{ visible: card.status === 'visible' }"
      >
        @for (comic of card.comics; track comic) {
        <img [src]="comic" [alt]="card.title + ' comic'" class="comic-image" />
        } @empty {
        <p>No comics available.</p>
        }
      </div>
    </div>
    }
  </div>

  <!-- Comments Section -->
  @if (showCommentsSection) {
  <div
    class="comments-section-separate"
    [ngClass]="{ visible: card.status === 'visible' }"
  >
    <app-comments
      [cardId]="card.title"
      (commentAdded)="onCommentAdded($event)"
    ></app-comments>
  </div>
  } }
</ng-template>

<ng-template #navigationControls>
  <div class="navigation-controls">
    <button
      class="nav-btn prev-btn"
      (click)="previousCard()"
      [disabled]="currentIndex === 0 || isTransitioning"
      aria-label="Previous card"
      #prevBtn
    >
      <i class="fas fa-chevron-left"></i>
    </button>

    <div class="card-indicator">
      <span class="current">{{ currentIndex + 1 }}</span>
      <span class="separator">/</span>
      <span class="total">{{ cards.length }}</span>
    </div>

    <button
      class="nav-btn next-btn"
      (click)="nextCard()"
      [disabled]="currentIndex === cards.length - 1 || isTransitioning"
      aria-label="Next card"
      #nextBtn
    >
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</ng-template>
