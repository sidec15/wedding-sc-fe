<section class="contact-form">
  @let isMobile = (isMobile$ | async) ?? false;

  <h2>{{ "contact_us.contact_form.title" | translate }}</h2>

  <!-- Chiara image for mobile -->
  @if (isMobile) {
  <div class="contact-form-image chiara">
    <img src="images/comics/comics-02.png" alt="Contact Us Chiara" />
  </div>
  }

  <h3>{{ "contact_us.contact_form.subtitle" | translate }}</h3>
  <p>{{ "contact_us.contact_form.description" | translate }}</p>

  <div class="form-row">
    <!-- Chiara image for desktop -->
    @if (!isMobile) {
    <div class="contact-form-image chiara">
      <img src="images/comics/comics-02.png" alt="Contact Us Chiara" />
    </div>
    }

    <div class="contact-form-section">

      <form
        class="contact-form"
        [formGroup]="contactForm"
        (ngSubmit)="onSubmit()"
      >
        <!-- Honeypot field -->
        <div class="hidden">
          <input
            type="text"
            formControlName="websiteContactForm"
            autocomplete="off"
          />
        </div>

        <div class="form-group">
          <label for="name" class="form-label"
            >{{ "contact_us.contact_form.name" | translate }} *</label
          >
          <input
            type="text"
            id="name"
            formControlName="name"
            class="form-input"
            [class.error]="
              contactForm.get('name')?.invalid &&
              contactForm.get('name')?.touched
            "
            maxlength="50"
          />
          @if (contactForm.get('name')?.invalid && contactForm.get('name')?.touched) {
          <div class="error-message">{{ getErrorMessage("name") }}</div>
          }
        </div>

        <div class="form-group">
          <label for="surname" class="form-label"
            >{{ "contact_us.contact_form.surname" | translate }} *</label
          >
          <input
            type="text"
            id="surname"
            formControlName="surname"
            class="form-input"
            [class.error]="
              contactForm.get('surname')?.invalid &&
              contactForm.get('surname')?.touched
            "
            maxlength="50"
          />
          @if (contactForm.get('surname')?.invalid && contactForm.get('surname')?.touched) {
          <div class="error-message">{{ getErrorMessage("surname") }}</div>
          }
        </div>

        <div class="form-group">
          <label for="phone" class="form-label">{{
            "contact_us.contact_form.phone" | translate
          }}</label>
          <input
            type="tel"
            id="phone"
            formControlName="phone"
            class="form-input"
            [class.error]="
              contactForm.get('phone')?.invalid &&
              contactForm.get('phone')?.touched
            "
            placeholder="+39 123 456 7890"
          />
          @if (contactForm.get('phone')?.invalid && contactForm.get('phone')?.touched) {
          <div class="error-message">{{ getErrorMessage("phone") }}</div>
          }
        </div>

        <div class="form-group">
          <label for="email" class="form-label">{{
            "contact_us.contact_form.email" | translate
          }}</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-input"
            [class.error]="
              contactForm.get('email')?.invalid &&
              contactForm.get('email')?.touched
            "
            required
          />
          @if (contactForm.get('email')?.invalid && contactForm.get('email')?.touched) {
          <div class="error-message">{{ getErrorMessage("email") }}</div>
          }
        </div>

        <div class="form-group">
          <label for="message" class="form-label">{{ "contact_us.contact_form.message" | translate }} *</label>

          <app-rich-text-editor
            id="message"
            formControlName="message"
            [placeholder]="'contact_us.contact_form.write_message' | translate"
            [emojiEnabled]="true"
            (lengthChange)="messageCharCount = $event"
            [error]="!!(messageControl?.invalid && messageControl?.touched)"
          >
          </app-rich-text-editor>

          <div class="char-count">
            {{ messageCharCount || 0 }}/{{ maxMessageLength }}
          </div>

          @if (contactForm.get('message')?.invalid &&
          contactForm.get('message')?.touched) {
          <div class="error-message">{{ getErrorMessage("message") }}</div>
          }
        </div>

        <app-security-consent
          [form]="contactForm"
          [submitted]="submitted"
          captchaControlName="captchaContactForm"
          privacyControlName="privacyContactForm"
        />

        <button class="submit-btn" type="submit" [disabled]="contactForm.invalid || isSubmitting">
          @if (!isSubmitting) {
          {{ "contact_us.contact_form.submit" | translate }}
          } @else {
          {{ "contact_us.contact_form.submitting" | translate }}
          }
        </button>
      </form>
    </div>

    <!-- Simone image for desktop -->
    @if (!isMobile) {
    <div class="contact-form-image simone">
      <img src="images/comics/comics-03.png" alt="Contact Us Simone" />
    </div>
    }
  </div>

  <!-- Simone image for mobile -->
  @if (isMobile) {
  <div class="contact-form-image simone">
    <img src="images/comics/comics-03.png" alt="Contact Us Simone" />
  </div>
  }
</section>
<app-ring-scroll></app-ring-scroll>
